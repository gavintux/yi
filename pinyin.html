<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼¢èªæ‹¼éŸ³è¼¸å…¥æ³•ç·´ç¿’å¹³å°</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* è¨­å®šå­—é«” */
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        /* è‡ªå®šç¾©ç„¦é»æ¨£å¼ */
        .input-focus:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5); /* Blue ring */
            border-color: #4299e1;
        }
        /* è²èª¿é–‹é—œçš„é»ç§»å‹•æ¨£å¼ */
        #tone-switch:checked ~ .block {
            background-color: #4f46e5; /* indigo-600 */
        }
        #tone-switch:checked ~ .dot {
            transform: translateX(100%);
        }
        /* ç¢ºä¿æ³¨éŸ³ç¬¦è™Ÿæ­£ç¢ºé¡¯ç¤º */
        .zhuyin {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
            color: #4338ca; /* indigo-700 */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-lg bg-white shadow-2xl rounded-xl p-6 md:p-10 border border-gray-100">
        
        <!-- Header -->
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6 border-b pb-3">
            æ¼¢èªæ‹¼éŸ³ç·´ç¿’
        </h1>

        <!-- Settings -->
        <div class="flex justify-between items-center mb-6 p-3 bg-indigo-50 rounded-lg">
            <label for="tone-switch" class="flex items-center space-x-2 cursor-pointer">
                <span class="text-sm font-medium text-indigo-800">è¦æ±‚è²èª¿ (e.g., zhong1)</span>
                <div class="relative">
                    <input type="checkbox" id="tone-switch" class="sr-only" checked>
                    <div class="block bg-gray-300 w-10 h-6 rounded-full transition-all"></div>
                    <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-all shadow"></div>
                </div>
            </label>
            <p class="text-lg font-semibold text-gray-700">
                å¾—åˆ†: <span id="score-display">0</span>
            </p>
        </div>

        <!-- Practice Area -->
        <div class="text-center mb-8">
            <p class="text-gray-500 mb-4 text-base font-medium" id="pinyin-hint">
                <!-- æ‹¼éŸ³æç¤ºæœƒé¡¯ç¤ºåœ¨é€™è£¡ (è‹¥éœ€è¦) -->
            </p>
            <div id="target-text-container" class="min-h-[120px] flex items-center justify-center">
                <p id="target-text" class="text-6xl md:text-7xl font-extrabold text-gray-900 tracking-wider">
                    è®€å–ä¸­...
                </p>
            </div>
        </div>
        
        <!-- Pinyin Chart Toggle Button -->
        <button id="toggle-chart-btn" class="w-full text-sm font-semibold text-center py-2 px-4 rounded-lg bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition-colors mt-4">
            é¡¯ç¤º æ³¨éŸ³åŠæ¼¢èªæ‹¼éŸ³å°ç…§è¡¨
        </button>

        <!-- Pinyin Chart Container (Initially hidden) -->
        <div id="pinyin-chart-container" class="mt-4 p-4 border border-gray-200 rounded-lg bg-white hidden max-h-[400px] overflow-y-auto">
            
            <h3 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2">è²èª¿å°ç…§ (Tones)</h3>
            <!-- Tones Table: 5 Columns -->
            <div class="grid grid-cols-5 text-center gap-1 mb-6 text-sm">
                <div class="p-1 bg-gray-100 font-bold">æ³¨éŸ³è²èª¿</div>
                <div class="p-1 bg-gray-100 font-bold">æ‹¼éŸ³èª¿è™Ÿ</div>
                <div class="p-1 bg-gray-100 font-bold">æ•¸å­—</div>
                <div class="p-1 bg-gray-100 font-bold col-span-2">ç¯„ä¾‹ (Pinyin)</div>
                
                <div class="p-1 border text-green-700 font-medium">ç„¡</div>
                <div class="p-1 border text-green-700 font-medium">Ä</div>
                <div class="p-1 border font-mono">1</div>
                <div class="p-1 border font-mono col-span-2">mÄ</div>

                <div class="p-1 border text-green-700 font-medium">ËŠ</div>
                <div class="p-1 border text-green-700 font-medium">Ã¡</div>
                <div class="p-1 border font-mono">2</div>
                <div class="p-1 border font-mono col-span-2">mÃ¡</div>

                <div class="p-1 border text-green-700 font-medium">Ë‡</div>
                <div class="p-1 border text-green-700 font-medium">Ç</div>
                <div class="p-1 border font-mono">3</div>
                <div class="p-1 border font-mono col-span-2">mÇ</div>

                <div class="p-1 border text-green-700 font-medium">Ë‹</div>
                <div class="p-1 border text-green-700 font-medium">Ã </div>
                <div class="p-1 border font-mono">4</div>
                <div class="p-1 border font-mono col-span-2">mÃ </div>

                <div class="p-1 border text-green-700 font-medium">Ë™</div>
                <div class="p-1 border text-green-700 font-medium">a</div>
                <div class="p-1 border font-mono">5 / ç„¡</div>
                <div class="p-1 border font-mono col-span-2">ma (è¼•è²)</div>
            </div>

            <h3 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2">è²æ¯å°ç…§ (Initials)</h3>
            <!-- Initials Table: Using grid-cols-8 for a balanced layout -->
            <div class="grid grid-cols-8 text-center gap-1 text-sm mb-6">
                
                <div class="p-1 bg-indigo-100 font-bold col-span-8">é›™å”‡/å”‡é½’ (Zhuyin | Pinyin)</div>
                <div class="p-1 border col-span-2 zhuyin">ã„… (b)</div>
                <div class="p-1 border col-span-2 zhuyin">ã„† (p)</div>
                <div class="p-1 border col-span-2 zhuyin">ã„‡ (m)</div>
                <div class="p-1 border col-span-2 zhuyin">ã„ˆ (f)</div>
                
                <div class="p-1 bg-indigo-100 font-bold col-span-8">èˆŒå°–ä¸­ (Zhuyin | Pinyin)</div>
                <div class="p-1 border col-span-2 zhuyin">ã„‰ (d)</div>
                <div class="p-1 border col-span-2 zhuyin">ã„Š (t)</div>
                <div class="p-1 border col-span-2 zhuyin">ã„‹ (n)</div>
                <div class="p-1 border col-span-2 zhuyin">ã„Œ (l)</div>
                
                <div class="p-1 bg-indigo-100 font-bold col-span-8">èˆŒæ ¹/èˆŒé¢å‰ (Zhuyin | Pinyin)</div>
                <div class="p-1 border zhuyin">ã„ (g)</div>
                <div class="p-1 border zhuyin">ã„ (k)</div>
                <div class="p-1 border zhuyin">ã„ (h)</div>
                <div class="p-1 border zhuyin">ã„ (j)</div>
                <div class="p-1 border zhuyin">ã„‘ (q)</div>
                <div class="p-1 border zhuyin">ã„’ (x)</div>
                <div class="p-1 border col-span-2 text-gray-400"></div>

                <div class="p-1 bg-indigo-100 font-bold col-span-8">æ²èˆŒ/èˆŒå°–å‰/åŠå…ƒéŸ³ (Zhuyin | Pinyin)</div>
                <div class="p-1 border zhuyin">ã„“ (zh)</div>
                <div class="p-1 border zhuyin">ã„” (ch)</div>
                <div class="p-1 border zhuyin">ã„• (sh)</div>
                <div class="p-1 border zhuyin">ã„– (r)</div>
                <div class="p-1 border zhuyin">ã„— (z)</div>
                <div class="p-1 border zhuyin">ã„˜ (c)</div>
                <div class="p-1 border zhuyin">ã„™ (s)</div>
                <div class="p-1 border text-gray-400"></div>
            </div>

            <h3 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2">éŸ»æ¯å°ç…§ (Finals)</h3>
            <!-- Finals Table: Using grid-cols-7 -->
            <div class="grid grid-cols-7 text-center gap-1 text-sm">
                <div class="p-1 bg-indigo-100 font-bold col-span-7">å–®éŸ»æ¯ & è¤‡éŸ»æ¯ (Zhuyin | Pinyin)</div>
                <div class="p-1 border zhuyin">ã„š (a)</div><div class="p-1 border zhuyin">ã„› (o)</div><div class="p-1 border zhuyin">ã„œ (e)</div><div class="p-1 border zhuyin">ã„ (Ãª)</div><div class="p-1 border zhuyin">ã„§ (i)</div><div class="p-1 border zhuyin">ã„¨ (u)</div><div class="p-1 border zhuyin">ã„© (Ã¼/v)</div>
                <div class="p-1 border zhuyin">ã„ (ai)</div><div class="p-1 border zhuyin">ã„Ÿ (ei)</div><div class="p-1 border zhuyin">ã„  (ao)</div><div class="p-1 border zhuyin">ã„¡ (ou)</div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin">ã„¦ (er)</div>

                <div class="p-1 bg-indigo-100 font-bold col-span-7">å‰é¼»éŸ³éŸ»æ¯ (-n)</div>
                <div class="p-1 border zhuyin">ã„¢ (an)</div><div class="p-1 border zhuyin">ã„£ (en)</div><div class="p-1 border zhuyin">ã„§ã„£ (in)</div><div class="p-1 border zhuyin">ã„¨ã„£ (un)</div><div class="p-1 border zhuyin">ã„©ã„£ (Ã¼n)</div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin"></div>

                <div class="p-1 bg-indigo-100 font-bold col-span-7">å¾Œé¼»éŸ³éŸ»æ¯ (-ng)</div>
                <div class="p-1 border zhuyin">ã„¤ (ang)</div><div class="p-1 border zhuyin">ã„¥ (eng)</div><div class="p-1 border zhuyin">ã„§ã„¥ (ing)</div><div class="p-1 border zhuyin">ã„¨ã„¥ (ong)</div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin"></div>

                <div class="p-1 bg-indigo-100 font-bold col-span-7">çµåˆéŸ»æ¯ (i, u, Ã¼)</div>
                <div class="p-1 border zhuyin">ã„§ã„š (ia)</div><div class="p-1 border zhuyin">ã„§ã„ (ie)</div><div class="p-1 border zhuyin">ã„¨ã„š (ua)</div><div class="p-1 border zhuyin">ã„¨ã„› (uo)</div><div class="p-1 border zhuyin">ã„©ã„ (Ã¼e)</div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin"></div>
                <div class="p-1 border zhuyin">ã„§ã„  (iao)</div><div class="p-1 border zhuyin">ã„§ã„¡ (iu)</div><div class="p-1 border zhuyin">ã„¨ã„ (uai)</div><div class="p-1 border zhuyin">ã„¨ã„Ÿ (ui)</div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin"></div>
                <div class="p-1 border zhuyin">ã„§ã„¢ (ian)</div><div class="p-1 border zhuyin">ã„§ã„¤ (iang)</div><div class="p-1 border zhuyin">ã„§ã„¥ (ing)</div><div class="p-1 border zhuyin">ã„¨ã„¢ (uan)</div><div class="p-1 border zhuyin">ã„¨ã„¤ (uang)</div><div class="p-1 border zhuyin"></div><div class="p-1 border zhuyin"></div>
            </div>
        </div>

        <!-- Input and Feedback -->
        <div class="space-y-4">
            <input 
                type="text" 
                id="pinyin-input" 
                placeholder="åœ¨æ­¤è¼¸å…¥æ‹¼éŸ³ (ä¾‹å¦‚: zhongguo2)" 
                class="w-full p-3 md:p-4 text-xl border-2 border-gray-300 rounded-lg input-focus transition-colors shadow-inner"
                autocomplete="off"
            >
            <div id="feedback-message" class="min-h-[30px] text-center text-lg font-semibold rounded-lg p-1">
                <!-- ç·´ç¿’é–‹å§‹ï¼ -->
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // æ ¸å¿ƒè³‡æ–™é›†: ä¸­æ–‡å­—èˆ‡å°æ‡‰çš„æ•¸å­—è²èª¿æ‹¼éŸ³
        const dataSet = [
            { hanzi: "ä¸­åœ‹", pinyin: "zhong1 guo2" },
            { hanzi: "å­¸ç¿’", pinyin: "xue2 xi2" },
            { hanzi: "èªè¨€", pinyin: "yu3 yan2" },
            { hanzi: "é›»è…¦", pinyin: "dian4 nao3" },
            { hanzi: "è¨­è¨ˆ", pinyin: "she4 ji4" },
            { hanzi: "è¼¸å…¥æ³•", pinyin: "shu1 ru4 fa3" },
            { hanzi: "éµç›¤", pinyin: "jian4 pan2" },
            { hanzi: "æ¸¬è©¦", pinyin: "ce4 shi4" },
            { hanzi: "æ­¡è¿", pinyin: "huan1 ying2" },
            { hanzi: "ä¸–ç•Œ", pinyin: "shi4 jie4" },
            { hanzi: "ç”Ÿæ´»", pinyin: "sheng1 huo2" },
            { hanzi: "æœ‹å‹", pinyin: "peng2 you" },
            { hanzi: "è€å¸«", pinyin: "lao3 shi1" },
            { hanzi: "æ°´æœ", pinyin: "shui3 guo3" },
            { hanzi: "æ˜¥å¤©", pinyin: "chun1 tian1" },
            { hanzi: "å¤æ—¥", pinyin: "xia4 ri4" },
            { hanzi: "ç§‹é¢¨", pinyin: "qiu1 feng1" },
            { hanzi: "å†¬é›ª", pinyin: "dong1 xue3" },
            { hanzi: "ç¾éº—", pinyin: "mei3 li4" },
            { hanzi: "å¿«æ¨‚", pinyin: "kuai4 le4" },
        ];

        let currentIndex = -1;
        let score = 0;
        let useTones = true; // é è¨­ä½¿ç”¨è²èª¿
        let shuffledDataSet = [];
        
        // DOM å…ƒç´ 
        const targetTextElement = document.getElementById('target-text');
        const pinyinInputElement = document.getElementById('pinyin-input');
        const feedbackMessageElement = document.getElementById('feedback-message');
        const scoreDisplayElement = document.getElementById('score-display');
        const toneSwitch = document.getElementById('tone-switch');
        const pinyinHintElement = document.getElementById('pinyin-hint');
        
        // æ¼¢èªæ‹¼éŸ³å°ç…§è¡¨ç›¸é—œ DOM å…ƒç´  (æ–°å¢)
        const toggleChartBtn = document.getElementById('toggle-chart-btn');
        const pinyinChartContainer = document.getElementById('pinyin-chart-container');

        /**
         * æ´—ç‰Œæ¼”ç®—æ³• (Fisher-Yates)
         * @param {Array} array 
         */
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        /**
         * ç§»é™¤æ‹¼éŸ³ä¸­çš„æ•¸å­—è²èª¿
         * @param {string} pinyin - æ•¸å­—è²èª¿æ‹¼éŸ³ (e.g., 'zhong1 guo2')
         * @returns {string} - ç„¡è²èª¿æ‹¼éŸ³ (e.g., 'zhong guo')
         */
        function stripTones(pinyin) {
            return pinyin.replace(/[1-5]/g, '').trim();
        }

        /**
         * æ ¼å¼åŒ–ç”¨æˆ¶è¼¸å…¥ï¼Œæ–¹ä¾¿æ¯”è¼ƒ
         * @param {string} input - ç”¨æˆ¶è¼¸å…¥çš„åŸå§‹å­—ä¸²
         * @returns {string} - æ¨™æº–åŒ–å¾Œçš„æ‹¼éŸ³å­—ä¸²
         */
        function normalizeInput(input) {
            // è½‰æ›ç‚ºå°å¯«ï¼Œæ›¿æ› 'v' ç‚º 'Ã¼' (é›–ç„¶æ‹¼éŸ³è¼¸å…¥æ³•é€šå¸¸æ¥å— v)
            let normalized = input.toLowerCase().trim();
            normalized = normalized.replace(/v/g, 'Ã¼');
            // å°‡æ‰€æœ‰é€£çºŒç©ºæ ¼æ›¿æ›ç‚ºå–®å€‹ç©ºæ ¼
            return normalized.replace(/\s+/g, ' ');
        }
        
        /**
         * è¼‰å…¥ä¸‹ä¸€é“é¡Œç›®
         */
        function loadNextWord() {
            currentIndex = (currentIndex + 1) % shuffledDataSet.length;
            const currentItem = shuffledDataSet[currentIndex];
            
            targetTextElement.textContent = currentItem.hanzi;
            pinyinInputElement.value = '';
            pinyinInputElement.focus();
            feedbackMessageElement.textContent = 'è«‹è¼¸å…¥æ‹¼éŸ³...';
            feedbackMessageElement.className = 'min-h-[30px] text-center text-lg font-semibold rounded-lg p-1 text-gray-500';

            // æ ¹æ“šæ¨¡å¼è¨­å®šæ‹¼éŸ³æç¤º (åƒ…ç”¨æ–¼å±•ç¤ºï¼Œå¯¦éš›ç·´ç¿’ä¸­ä¸æ‡‰è©²æç¤º)
            if (currentIndex === 0) {
                 pinyinHintElement.textContent = `ç•¶å‰æ¨¡å¼ï¼š${useTones ? 'è¦æ±‚è²èª¿' : 'ä¸è¦æ±‚è²èª¿'}`;
            } else {
                 pinyinHintElement.textContent = '';
            }
        }

        /**
         * è™•ç†ä¸¦æª¢æŸ¥ç”¨æˆ¶è¼¸å…¥
         */
        function checkInput() {
            const userInput = normalizeInput(pinyinInputElement.value);
            const currentItem = shuffledDataSet[currentIndex];
            const correctPinyinWithTones = normalizeInput(currentItem.pinyin);

            let isCorrect = false;
            let expectedPinyin = correctPinyinWithTones;

            if (useTones) {
                // è²èª¿æ¨¡å¼: å¿…é ˆå®Œå…¨åŒ¹é…
                isCorrect = (userInput === correctPinyinWithTones);
            } else {
                // ç„¡è²èª¿æ¨¡å¼: ç§»é™¤è²èª¿å¾ŒåŒ¹é…
                const correctPinyinNoTones = stripTones(correctPinyinWithTones);
                const userInputNoTones = stripTones(userInput);
                isCorrect = (userInputNoTones === correctPinyinNoTones);
                expectedPinyin = correctPinyinNoTones; // é¡¯ç¤ºç„¡è²èª¿çš„æ­£ç¢ºç­”æ¡ˆ
            }

            if (isCorrect) {
                // ç­”å°
                score++;
                scoreDisplayElement.textContent = score;
                feedbackMessageElement.textContent = 'æ­£ç¢ºï¼ğŸ‘';
                feedbackMessageElement.className = 'min-h-[30px] text-center text-lg font-semibold rounded-lg p-1 text-green-700 bg-green-100';
                
                // å»¶é²è¼‰å…¥ä¸‹ä¸€é¡Œ
                setTimeout(loadNextWord, 500);
            } else {
                // ç­”éŒ¯
                feedbackMessageElement.textContent = `éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯: ${expectedPinyin}`;
                feedbackMessageElement.className = 'min-h-[30px] text-center text-lg font-semibold rounded-lg p-1 text-red-700 bg-red-100';
            }
        }

        /**
         * åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
         */
        function init() {
            // è¤‡è£½ä¸¦æ´—ç‰Œè³‡æ–™é›†
            shuffledDataSet = shuffle([...dataSet]);
            
            // ç›£è½è¼¸å…¥æ¡†çš„ Enter éµ
            pinyinInputElement.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault(); // é˜²æ­¢æ›è¡Œ
                    checkInput();
                }
            });

            // ç›£è½è²èª¿é–‹é—œ
            toneSwitch.addEventListener('change', function() {
                useTones = this.checked;
                // é‡ç½®åˆ†æ•¸ä¸¦é‡æ–°é–‹å§‹ï¼Œä»¥æ‡‰ç”¨æ–°è¨­å®š
                score = 0;
                scoreDisplayElement.textContent = 0;
                shuffledDataSet = shuffle([...dataSet]);
                currentIndex = -1; // æœƒè¢« loadNextWord éå¢åˆ° 0
                loadNextWord();
            });

            // æ¼¢èªæ‹¼éŸ³å°ç…§è¡¨é–‹é—œé‚è¼¯ (æ–°å¢)
            toggleChartBtn.addEventListener('click', function() {
                const isHidden = pinyinChartContainer.classList.toggle('hidden');
                if (isHidden) {
                    toggleChartBtn.textContent = 'é¡¯ç¤º æ³¨éŸ³åŠæ¼¢èªæ‹¼éŸ³å°ç…§è¡¨';
                } else {
                    toggleChartBtn.textContent = 'éš±è— æ³¨éŸ³åŠæ¼¢èªæ‹¼éŸ³å°ç…§è¡¨';
                }
            });

            // è¨­å®šè²èª¿é–‹é—œåˆå§‹ç‹€æ…‹
            toneSwitch.checked = useTones;

            // è¼‰å…¥ç¬¬ä¸€é“é¡Œç›®
            loadNextWord();
            feedbackMessageElement.textContent = 'ç·´ç¿’é–‹å§‹ï¼è«‹è¼¸å…¥æ‹¼éŸ³ä¸¦æŒ‰ Enterã€‚';
        }

        // å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
        window.onload = init;
    </script>
</body>
</html>
