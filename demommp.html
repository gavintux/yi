<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Loading...</title>
    <meta name="description" content="Loading...">
    <meta property="og:title" content="Loading...">
    <meta property="og:description" content="Loading...">
    <meta property="og:image" content="">
    
    <link rel="icon" id="dynamic-favicon" href="" />
    <link rel="apple-touch-icon" id="dynamic-apple-icon" href="">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* 基礎樣式 (顏色將由 JS 變數動態控制) */
        :root {
            --garden-bg: #f5f5f4;      /* 預設值，會被覆蓋 */
            --sidebar-bg: #ffffff;
            --primary-color: #059669;  /* 預設值，會被覆蓋 */
        }

        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif;
            background-color: var(--garden-bg);
            color: #44403c;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s ease;
        }

        /* 玻璃擬態與卡片特效 */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-4px) scale(1.01); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        
        /* 動畫定義 */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-scale-in { animation: scaleIn 0.1s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        /* 捲軸樣式 */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #d6d3d1; border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: #a8a29e; }

        /* 其他工具類 */
        .appearance-none { -webkit-appearance: none; appearance: none; }
        .pattern-grid { background-image: radial-gradient(rgba(255, 255, 255, 0.2) 1px, transparent 1px); background-size: 20px 20px; }
        .pattern-wave { background: repeating-linear-gradient( 45deg, rgba(255,255,255,0.05), rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px ); }
        
        /* Tooltip */
        .tooltip { visibility: hidden; position: absolute; z-index: 50; right: 0; top: 100%; margin-top: 0.5rem; width: 280px; background-color: #292524; color: #fafaf9; padding: 1rem; border-radius: 0.75rem; opacity: 0; transition: all 0.3s; }
        .has-tooltip:hover .tooltip { visibility: visible; opacity: 1; transform: translateY(2px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        //  ★ 網站全域設定檔 (SITE CONFIGURATION) ★
        //  請將此區塊交給使用者修改，即可客製化整個網站
        // ==========================================
        const SITE_CONFIG = {
            // 1. 基本資訊 (Basic Info)
            meta: {
                title: "Linkc MindMap Garden",          // 網站標題 (瀏覽器分頁顯示)
                description: "Linkc 的數位思維花園",      // 網站描述 (SEO / 分享預覽用)
                logoUrl: "https://2blog.ilc.edu.tw/linkc/wp-content/uploads/sites/141/2024/12/linkc-logo.png", // 左上角 Logo
                faviconUrl: "https://2blog.ilc.edu.tw/linkc/wp-content/uploads/sites/141/2024/12/linkc-logo.png" // 瀏覽器小圖示
            },

            // 2. 系統與連線 (System & Connection)
            system: {
                apiToken: 'KgWdA3krt3dkuS3yQ0TWiOghaYeSGR_tp7u_SV9k_go', // Mindomo API Token
                accessPassword: '590123',                                // 管理員密碼
                portalName: "Zen's Portal",                              // 側邊欄傳送門名稱
                portalUrl: "https://gavintux.github.io/yi/"              // 側邊欄傳送門網址
            },

            // 3. 外觀主題 (Theme & Colors)
            theme: {
                backgroundColor: "#f5f5f4",  // 背景顏色 (建議使用 Stone-100 或 Neutral 色系)
                primaryColor: "#059669",     // 主色調 (按鈕、強調文字顏色，目前是 Emerald-600)
                // 進階：如果想換成藍色系，可改為: backgroundColor: "#eff6ff", primaryColor: "#2563eb"
            }
        };
        // ==========================================


        const { useState, useEffect, useMemo, useCallback, useRef } = React;
        const INITIAL_MOCK_DATA = [
            { id: "1", title: "2025 年度目標規劃", description: "包含 #工作 #學習 的年度大計畫 #share", modified_at: "2025-01-21T09:00:00Z" },
            { id: "2", title: "網站改版架構圖", description: "公司官網設計 #工作 #專案 #急件", modified_at: "2025-01-15T14:30:00Z" },
            { id: "3", title: "個人財務報表", description: "每季回顧 #健康 #財務", modified_at: "2025-01-10T11:00:00Z" },
            { id: "4", title: "Python 學習筆記", description: "爬蟲與數據分析 #學習 #程式 #Coding #share", modified_at: "2025-01-18T16:00:00Z" },
            { id: "5", title: "健身菜單", description: "重訓與飲食控制 #健康 #運動", modified_at: "2024-12-25T10:15:00Z" }
        ];

        // Icons (Lucide)
        const Icons = {
            Leaf: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.79 8.55-9.76 10H11Z"/><path d="M8 14h.01"/><path d="M12.5 9h.01"/></svg>,
            Flower: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 7.5a4.5 4.5 0 1 1 4.5 4.5M12 7.5A4.5 4.5 0 1 0 7.5 12M12 7.5V9m-4.5 3a4.5 4.5 0 1 1 4.5 4.5M7.5 12H9m3 4.5a4.5 4.5 0 1 1 4.5-4.5M12 16.5V15m4.5-3a4.5 4.5 0 1 0-4.5-4.5M16.5 12H15"/></svg>,
            Portal: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m4.93 4.93 14.14 14.14"/><path d="m14.83 9.17-5.66 5.66"/></svg>,
            ExternalLink: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
            File: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Tag: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>,
            Grid: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>,
            Menu: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            Refresh: ({ spin }) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={spin ? "animate-spin" : ""}><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
            SortAsc: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="M11 4h10"/><path d="M11 8h7"/><path d="M11 12h4"/></svg>,
            SortDesc: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 8 4-4 4 4"/><path d="M7 4v16"/><path d="M11 12h4"/><path d="M11 16h7"/><path d="M11 20h10"/></svg>,
            ArrowDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>,
            Bug: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>,
            Info: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
            Lock: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Unlock: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>,
            Share2: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>,
            Link: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            Copy: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Home: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            CheckCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-emerald-500 fill-emerald-100"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
            Circle: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-white drop-shadow-md"><circle cx="12" cy="12" r="10"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        };

        const PasswordModal = ({ onSubmit, onClose }) => {
            const [input, setInput] = useState('');
            const [error, setError] = useState('');
            const handleSubmit = () => {
                if (input === SITE_CONFIG.system.accessPassword) { onSubmit(); } else { setError('密碼錯誤'); }
            };
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-stone-900 bg-opacity-40 animate-fade-in p-4 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden p-6 border border-stone-100">
                        <h3 className="text-lg font-bold text-stone-800 mb-4 flex items-center gap-2"><Icons.Lock /> 管理員權限驗證</h3>
                        <p className="text-sm text-stone-600 mb-4">請輸入密碼以進入花園深處：</p>
                        <input type="password" value={input} onChange={(e) => { setInput(e.target.value); setError(''); }} onKeyDown={(e) => e.key === 'Enter' && handleSubmit()} className="w-full px-4 py-2.5 bg-stone-50 border border-stone-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none mb-2 text-stone-800" placeholder="輸入密碼" autoFocus />
                        {error && <p className="text-xs text-rose-500 mb-2">{error}</p>}
                        <div className="flex justify-end gap-2 mt-4">
                            <button onClick={onClose} className="px-4 py-2 text-sm font-medium text-stone-500 hover:bg-stone-100 rounded-xl transition-colors">取消</button>
                            <button onClick={handleSubmit} className="px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-xl transition-colors shadow-lg shadow-emerald-600/20">確認</button>
                        </div>
                    </div>
                </div>
            );
        };

        // Helper: Extract tags from description
        const extractTags = (text) => {
            if (!text || typeof text !== 'string') return [];
            const cleanText = text.replace(/<[^>]*>?/gm, '');
            const matches = cleanText.match(/#[\S]+/g);
            return matches ? matches.map(tag => tag.substring(1)).filter(t => t.length > 0) : [];
        };

        // Helper: Format Date
        const formatDate = (isoString) => {
            if (!isoString) return "無資料";
            const date = new Date(isoString);
            return isNaN(date.getTime()) ? "日期錯誤" : new Intl.DateTimeFormat('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }).format(date);
        };

        // Helper: Generate Visual Identity
        const generateVisualIdentity = (id, title) => {
            const str = id + title;
            let hash = 0;
            for (let i = 0; i < str.length; i++) { hash = str.charCodeAt(i) + ((hash << 5) - hash); }
            const palettes = [
                ['from-emerald-400 to-cyan-500', 'from-teal-400 to-yellow-200'], ['from-rose-300 to-orange-300', 'from-amber-200 to-yellow-400'], 
                ['from-fuchsia-300 to-purple-400', 'from-violet-400 to-fuchsia-300'], ['from-blue-400 to-indigo-400', 'from-sky-300 to-blue-500'], 
                ['from-lime-400 to-green-500', 'from-emerald-300 to-lime-300']
            ];
            const paletteIndex = Math.abs(hash) % palettes.length;
            const gradientType = Math.abs(hash >> 1) % 2;
            return { gradient: palettes[paletteIndex][gradientType], isWave: (Math.abs(hash >> 2) % 2) === 0 };
        };

        const App = () => {
            const [isAuthorized, setIsAuthorized] = useState(false);
            const [showPasswordModal, setShowPasswordModal] = useState(false);
            const [diagrams, setDiagrams] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [useRealApi, setUseRealApi] = useState(true);
            const [showDebug, setShowDebug] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [debouncedSearchTerm, setDebouncedSearchTerm] = useState('');
            const [rawData, setRawData] = useState(null);
            const [downloadingState, setDownloadingState] = useState(null);
            const [activeCategory, setActiveCategory] = useState('all'); 
            const [currentPage, setCurrentPage] = useState(1);
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            const [tagSearchQuery, setTagSearchQuery] = useState('');
            const [isTagExpanded, setIsTagExpanded] = useState(false);
            const [sortField, setSortField] = useState('modified_at');
            const [sortOrder, setSortOrder] = useState('desc');
            const [selectedIds, setSelectedIds] = useState(new Set());
            const [collectionIds, setCollectionIds] = useState(null);

            // === 系統核心：套用 SITE_CONFIG 到網頁 ===
            useEffect(() => {
                // 1. 設定標題
                document.title = SITE_CONFIG.meta.title;
                
                // 2. 設定 Meta Tags (動態注入)
                const updateMeta = (name, content, prop = 'name') => {
                    let tag = document.querySelector(`meta[${prop}="${name}"]`);
                    if (!tag) {
                        tag = document.createElement('meta');
                        tag.setAttribute(prop, name);
                        document.head.appendChild(tag);
                    }
                    tag.setAttribute('content', content);
                };
                
                updateMeta('description', SITE_CONFIG.meta.description);
                updateMeta('og:title', SITE_CONFIG.meta.title, 'property');
                updateMeta('og:description', SITE_CONFIG.meta.description, 'property');
                updateMeta('og:image', SITE_CONFIG.meta.logoUrl, 'property');

                // 3. 設定 Favicon
                const setFavicon = (id, url) => {
                    let link = document.getElementById(id);
                    if (!link) {
                        link = document.createElement('link');
                        link.id = id;
                        link.rel = id.includes('apple') ? 'apple-touch-icon' : 'icon';
                        document.head.appendChild(link);
                    }
                    link.href = url;
                };
                setFavicon('dynamic-favicon', SITE_CONFIG.meta.faviconUrl);
                setFavicon('dynamic-apple-icon', SITE_CONFIG.meta.faviconUrl);

                // 4. 設定 CSS 變數 (主題顏色)
                const rootStyle = document.documentElement.style;
                rootStyle.setProperty('--garden-bg', SITE_CONFIG.theme.backgroundColor);
                rootStyle.setProperty('--primary-color', SITE_CONFIG.theme.primaryColor);

            }, []);

            // 檢查 URL 參數，讀取分享的 IDs
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const idsParam = params.get('ids');
                if (idsParam) {
                    const ids = idsParam.split(',').filter(id => id.trim().length > 0);
                    if (ids.length > 0) {
                        setCollectionIds(ids);
                        setActiveCategory('shared_collection');
                    }
                }
            }, []);

            useEffect(() => {
                const timer = setTimeout(() => setDebouncedSearchTerm(searchTerm), 300);
                return () => clearTimeout(timer);
            }, [searchTerm]);

            useEffect(() => {
                if (!useRealApi) {
                     const normalizedMock = INITIAL_MOCK_DATA.map(item => ({ ...item, tags: extractTags(item.description) }));
                     setDiagrams(normalizedMock);
                     setRawData(INITIAL_MOCK_DATA);
                } else {
                    fetchDiagrams();
                }
            }, [useRealApi]);

            useEffect(() => { setCurrentPage(1); }, [debouncedSearchTerm, activeCategory, sortField, sortOrder, collectionIds]);

            const fetchDiagrams = async () => {
                if (!SITE_CONFIG.system.apiToken) { setError("未設定 API Token"); return; }
                setLoading(true); setError(null);
                setRawData(null);
                try {
                    const response = await fetch('https://www.mindomo.com/api/v1/diagrams', {
                        method: 'GET',
                        headers: { 'Authorization': `Bearer ${SITE_CONFIG.system.apiToken}`, 'Content-Type': 'application/json' }
                    });
                    if (!response.ok) throw new Error(response.status === 401 ? "Token 無效" : "API 錯誤");
                    const data = await response.json();
                    setRawData(data);
                    let items = Array.isArray(data) ? data : (data.diagrams || []);
                    const normalizedData = items.map(item => {
                        const modDate = item.modified || item.lastModified || item.modified_at || item.updated || item.updated_at || item.dateModified;
                        const createDate = item.created_at || item.creationDate || item.created || item.dateCreated;
                        const description = item.description || item.note || ""; 
                        return {
                            id: item.id,
                            title: item.title || item.name || "未命名檔案",
                            description: description,
                            tags: extractTags(description), 
                            thumbnailUrl: item.thumbnailUrl || item.thumbnail_url,
                            created_at: createDate || new Date().toISOString(),
                            modified_at: modDate || createDate,
                            _raw: item
                        };
                    });
                    setDiagrams(normalizedData);
                } catch (err) { console.error(err); setError(err.message); } finally { setLoading(false); }
            };

            const handleDownload = async (e, item, format) => {
                e.stopPropagation();
                if (!SITE_CONFIG.system.apiToken) { alert("API Token 設定錯誤"); return; }
                setDownloadingState({ id: item.id, format: format });
                try {
                    const apiFormat = format === 'md' ? 'txt' : format;
                    if (!useRealApi) { await new Promise(resolve => setTimeout(resolve, 800)); alert(`(Demo) 下載 ${item.title}.${format}`); setDownloadingState(null); return; }
                    const response = await fetch(`https://www.mindomo.com/api/v1/diagrams/${item.id}.${apiFormat}`, { headers: { 'Authorization': `Bearer ${SITE_CONFIG.system.apiToken}` } });
                    if (!response.ok) throw new Error(`API 錯誤: ${response.status}`);
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a'); a.href = url; a.download = `${item.title}.${format}`; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url); document.body.removeChild(a);
                } catch (err) { console.error(err); alert('下載失敗: ' + err.message); } finally { setDownloadingState(null); }
            };

            const toggleSelection = (e, id) => {
                e.stopPropagation();
                const newSelection = new Set(selectedIds);
                newSelection.has(id) ? newSelection.delete(id) : newSelection.add(id);
                setSelectedIds(newSelection);
            };

            const handleGenerateCollectionLink = () => {
                if (selectedIds.size === 0) return;
                const url = new URL(window.location.href);
                url.search = `?ids=${Array.from(selectedIds).join(',')}`;
                navigator.clipboard.writeText(url.toString()).then(() => alert(`已複製分享連結！`)).catch(() => prompt("請手動複製：", url.toString()));
            };

            const permittedDiagrams = useMemo(() => isAuthorized ? diagrams : diagrams.filter(item => item.tags && item.tags.some(t => t.toLowerCase() === 'share')), [diagrams, isAuthorized]);
            
            const sortedTags = useMemo(() => {
                const tagsCount = {};
                permittedDiagrams.forEach(d => d.tags && d.tags.forEach(tag => tagsCount[tag] = (tagsCount[tag] || 0) + 1));
                return Object.entries(tagsCount).sort(([, a], [, b]) => b - a).map(([tag, count]) => ({ name: tag, count }));
            }, [permittedDiagrams]);

            const visibleTags = useMemo(() => {
                let tags = sortedTags;
                if (tagSearchQuery) tags = tags.filter(t => t.name.toLowerCase().includes(tagSearchQuery.toLowerCase()));
                return (!isTagExpanded && !tagSearchQuery) ? tags.slice(0, 10) : tags;
            }, [sortedTags, tagSearchQuery, isTagExpanded]);

            const processedData = useMemo(() => {
                let baseList = [...permittedDiagrams];
                const trimmedTerm = debouncedSearchTerm.trim();
                if (trimmedTerm) {
                    const lower = trimmedTerm.toLowerCase();
                    baseList = baseList.filter(item => item.title.toLowerCase().includes(lower) || item.description?.toLowerCase().includes(lower) || item.tags?.some(t => t.toLowerCase().includes(lower)));
                }
                
                let filtered = baseList;
                if (activeCategory === 'shared_collection' && collectionIds) filtered = baseList.filter(item => collectionIds.includes(String(item.id)));
                else if (activeCategory === 'recent') filtered = [...baseList].filter(item => item.modified_at).sort((a, b) => new Date(b.modified_at) - new Date(a.modified_at)).slice(0, 20);
                else if (activeCategory === 'uncategorized') filtered = baseList.filter(item => !item.tags || item.tags.length === 0);
                else if (activeCategory !== 'all') filtered = baseList.filter(item => item.tags && item.tags.includes(activeCategory));

                if (activeCategory !== 'recent') {
                    filtered.sort((a, b) => {
                        let valA = a[sortField], valB = b[sortField];
                        if (!valA) return 1; if (!valB) return -1;
                        const comparison = sortField === 'title' ? valA.localeCompare(valB, 'zh-Hant') : new Date(valA) - new Date(valB);
                        return sortOrder === 'asc' ? comparison : -comparison;
                    });
                }
                const totalItems = filtered.length;
                const items = filtered.slice((currentPage - 1) * 9, currentPage * 9); // Hardcoded 9 items per page
                return { items, totalItems, totalPages: Math.ceil(totalItems / 9) };
            }, [permittedDiagrams, debouncedSearchTerm, activeCategory, currentPage, sortField, sortOrder, collectionIds]);

            const Pagination = () => {
                if (processedData.totalPages <= 1) return null;
                return (
                    <div className="flex justify-center items-center gap-4 mt-12 pb-8">
                        <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} className="p-2 bg-white border border-stone-200 rounded-full hover:bg-stone-50 disabled:opacity-30 shadow-sm transition-all"><Icons.ChevronLeft /></button>
                        <span className="text-sm font-medium text-stone-600 bg-white px-4 py-1.5 rounded-full border border-stone-200 shadow-sm">第 {currentPage} / {processedData.totalPages} 頁</span>
                        <button onClick={() => setCurrentPage(p => Math.min(processedData.totalPages, p + 1))} disabled={currentPage === processedData.totalPages} className="p-2 bg-white border border-stone-200 rounded-full hover:bg-stone-50 disabled:opacity-30 shadow-sm transition-all"><Icons.ChevronRight /></button>
                    </div>
                );
            };

            const SidebarItem = ({ id, label, icon, count, activeOverride }) => (
                <button onClick={() => { setActiveCategory(id); setIsMobileMenuOpen(false); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 mb-1.5 ${(activeCategory === id || activeOverride) ? 'bg-emerald-50 text-emerald-700 shadow-sm border border-emerald-100' : 'text-stone-600 hover:bg-white hover:shadow-sm hover:text-stone-800 border border-transparent'}`}>
                    {icon}<span className="flex-grow text-left truncate">{label}</span>{count !== undefined && <span className="text-xs text-stone-400 bg-stone-100 px-2 py-0.5 rounded-full">{count}</span>}
                </button>
            );

            // Garden Card Component
            const GardenCard = ({ item }) => {
                const visual = useMemo(() => generateVisualIdentity(item.id, item.title), [item.id, item.title]);
                const [showShareMenu, setShowShareMenu] = useState(false);
                const [copyFeedback, setCopyFeedback] = useState(null);
                const isSelected = selectedIds.has(item.id);
                const handleCopyLink = (e) => {
                    e.stopPropagation();
                    navigator.clipboard.writeText(`https://www.mindomo.com/mindmap/${item.id}`).then(() => { setCopyFeedback(true); setTimeout(() => setCopyFeedback(false), 2000); });
                };
                return (
                    <div onClick={() => window.open(`https://www.mindomo.com/mindmap/${item.id}`, '_blank')} className={`group bg-white rounded-2xl border border-stone-100 shadow-sm hover:shadow-lg transition-all duration-300 flex flex-col h-full overflow-hidden cursor-pointer transform hover:-translate-y-1 relative ${isSelected ? 'ring-2 ring-emerald-500' : ''}`}>
                        <div className={`h-16 relative overflow-hidden bg-gradient-to-br ${visual.gradient}`}>
                            <div className={`absolute inset-0 opacity-20 ${visual.isWave ? 'pattern-wave' : 'pattern-grid'}`}></div>
                            <button onClick={(e) => toggleSelection(e, item.id)} className="absolute top-2 left-2 p-1.5 hover:scale-110 transition-transform z-10 text-white shadow-sm">{isSelected ? <Icons.CheckCircle /> : <Icons.Circle />}</button>
                            <div className="absolute top-2 right-3 bg-white/20 backdrop-blur-md px-2 py-0.5 rounded-lg border border-white/30 text-white text-[10px] font-medium">Mind Map</div>
                        </div>
                        <div className="p-5 flex-1 flex flex-col">
                            <h3 className="font-bold text-stone-800 leading-snug group-hover:text-emerald-600 transition-colors text-lg line-clamp-2 mb-3">{item.title}</h3>
                            <div className="flex flex-wrap gap-1.5 mb-4">{item.tags?.length > 0 ? item.tags.map(tag => <span key={tag} onClick={(e)=>{e.stopPropagation();setActiveCategory(tag)}} className="inline-flex items-center px-2 py-0.5 rounded-md text-[11px] font-medium bg-stone-50 text-stone-500 border border-stone-100 hover:bg-emerald-50 hover:text-emerald-600 hover:border-emerald-100 transition-colors">#{tag}</span>) : <span className="text-xs text-stone-300 italic">無標籤</span>}</div>
                            <div className="mt-auto pt-4 border-t border-stone-50 flex items-center justify-between">
                                <div className="flex items-center text-xs text-stone-400 gap-1.5"><Icons.Clock /><span>{formatDate(item.modified_at).split(' ')[0]}</span></div>
                                <div className="flex gap-1 relative">
                                    <button onClick={handleCopyLink} className="px-2 py-1 text-stone-400 bg-stone-50 hover:bg-stone-100 rounded border border-stone-200 transition-colors hover:text-emerald-600" title="複製連結">{copyFeedback ? <Icons.Check /> : <Icons.Share2 />}</button>
                                    <div className="w-px bg-stone-200 mx-1 h-5 self-center"></div>
                                    {['png', 'pdf', 'mm'].map(fmt => (
                                        <button key={fmt} onClick={(e) => handleDownload(e, item, fmt)} disabled={downloadingState?.id === item.id} className="px-2 py-1 text-[10px] font-bold text-stone-500 bg-stone-50 hover:bg-stone-100 rounded border border-stone-200 transition-colors uppercase tracking-wide">
                                            {downloadingState?.id === item.id && downloadingState.format === fmt ? <Icons.Refresh spin={true} /> : fmt.toUpperCase()}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    <header className="lg:hidden bg-white/80 backdrop-blur-md border-b border-stone-200 sticky top-0 z-30 h-16 flex items-center px-4 justify-between">
                        <div className="flex items-center gap-3">
                            <img src={SITE_CONFIG.meta.logoUrl} alt="Logo" className="h-8 w-8 rounded-lg object-cover shadow-sm" />
                            <h1 className="font-bold text-stone-800 text-lg tracking-wide">{SITE_CONFIG.meta.title}</h1>
                        </div>
                        <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="p-2 text-stone-600 hover:bg-stone-100 rounded-lg"><Icons.Menu /></button>
                    </header>
                    <div className="flex flex-1 overflow-hidden relative">
                        <aside className={`fixed inset-y-0 left-0 z-20 w-72 bg-white/90 border-r border-stone-200 transform transition-transform duration-300 cubic-bezier(0.4, 0, 0.2, 1) lg:translate-x-0 lg:static lg:h-auto backdrop-blur-xl ${isMobileMenuOpen ? 'translate-x-0 shadow-2xl' : '-translate-x-full'}`}>
                            <div className="h-full flex flex-col">
                                <div className="hidden lg:flex h-20 items-center px-6">
                                    <div className="flex items-center gap-3 text-stone-800">
                                        <img src={SITE_CONFIG.meta.logoUrl} alt="Logo" className="h-8 w-8 rounded-xl object-cover shadow-md" />
                                        <div className="flex flex-col"><span className="font-bold text-lg tracking-tight leading-tight">Linkc MindMap</span><span className="text-xs text-emerald-600 font-medium tracking-widest uppercase">Garden</span></div>
                                    </div>
                                </div>
                                <div className="flex-1 overflow-y-auto custom-scrollbar px-4 py-2">
                                    <div className="mb-6 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-4 border border-emerald-100/50 shadow-inner relative overflow-hidden group">
                                        <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity"><Icons.Portal /></div>
                                        <h4 className="text-xs font-bold text-emerald-700 uppercase tracking-wider mb-3 flex items-center gap-1.5"><Icons.Leaf /> 傳送門</h4>
                                        <a href={SITE_CONFIG.system.portalUrl} target="_blank" className="flex items-center gap-2 text-sm font-medium text-stone-700 hover:text-emerald-700 hover:underline transition-colors bg-white/60 p-2 rounded-lg border border-white/50 shadow-sm"><span>{SITE_CONFIG.system.portalName}</span><Icons.ExternalLink /></a>
                                    </div>
                                    <div className="mb-6">
                                        <p className="px-3 text-xs font-bold text-stone-400 uppercase tracking-widest mb-3">儀表板</p>
                                        <SidebarItem id="recent" label="最近翻土 (修改)" icon={<Icons.Clock />} />
                                        <SidebarItem id="all" label="花園全貌 (全部)" icon={<Icons.Grid />} count={permittedDiagrams.length} />
                                        {collectionIds && <SidebarItem id="shared_collection" label="精選花束 (分享連結)" icon={<Icons.Share2 />} count={collectionIds.length} activeOverride={activeCategory === 'shared_collection'} />}
                                    </div>
                                    <div className="mb-8">
                                        <div className="flex items-center justify-between px-3 mb-3">
                                            <p className="text-xs font-bold text-stone-400 uppercase tracking-widest">標籤花圃</p>
                                            {(isTagExpanded || sortedTags.length > 8) && <input type="text" placeholder="搜尋種子..." value={tagSearchQuery} onChange={(e) => setTagSearchQuery(e.target.value)} className="w-24 text-xs bg-stone-100 border-none rounded-md px-2 py-1 focus:ring-1 focus:ring-emerald-300 transition-all" />}
                                        </div>
                                        <div className="px-1 flex flex-wrap gap-2">{visibleTags.map(tag => <button key={tag.name} onClick={() => { setActiveCategory(tag.name); setIsMobileMenuOpen(false); }} className={`inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-medium transition-all duration-200 border ${activeCategory === tag.name ? 'bg-emerald-600 text-white border-emerald-600 shadow-md shadow-emerald-200' : 'bg-white text-stone-600 border-stone-200 hover:border-emerald-300 hover:text-emerald-700'}`}>#{tag.name}<span className={`ml-1.5 text-[10px] px-1 rounded-full ${activeCategory === tag.name ? 'bg-white/20' : 'bg-stone-100 text-stone-500'}`}>{tag.count}</span></button>)}</div>
                                        {sortedTags.length > 10 && !tagSearchQuery && <button onClick={() => setIsTagExpanded(!isTagExpanded)} className="w-full text-center text-xs text-stone-400 hover:text-emerald-600 mt-3 py-1 transition-colors">{isTagExpanded ? '收合' : `查看全部 (${sortedTags.length})`}</button>}
                                    </div>
                                </div>
                                <div className="p-4 border-t border-stone-100 bg-stone-50/50 backdrop-blur-sm space-y-2">
                                    <button onClick={() => isAuthorized ? setIsAuthorized(false) : setShowPasswordModal(true)} className={`w-full flex items-center justify-center gap-2 text-xs py-2.5 px-3 rounded-xl transition-all font-medium ${isAuthorized ? 'bg-rose-50 text-rose-600 hover:bg-rose-100' : 'bg-white text-stone-600 border border-stone-200 hover:border-stone-300 hover:shadow-sm'}`}>{isAuthorized ? <Icons.Unlock /> : <Icons.Lock />}{isAuthorized ? '離開管理模式' : '管理員登入'}</button>
                                    <button onClick={() => setUseRealApi(!useRealApi)} className="w-full text-xs py-2 px-3 rounded-xl text-stone-500 hover:bg-stone-100 transition-colors">{useRealApi ? 'Switch to Demo' : 'Switch to API'}</button>
                                </div>
                            </div>
                        </aside>
                        {isMobileMenuOpen && <div onClick={() => setIsMobileMenuOpen(false)} className="fixed inset-0 z-10 bg-stone-900/20 backdrop-blur-sm lg:hidden"></div>}
                        <main className="flex-1 overflow-y-auto custom-scrollbar h-full bg-stone-50/50 w-full relative">
                            <div className="absolute top-0 left-0 w-full h-64 bg-gradient-to-b from-emerald-50/50 to-transparent pointer-events-none" style={{ '--tw-gradient-from': SITE_CONFIG.theme.primaryColor + '10' }}></div>
                            <div className="max-w-6xl mx-auto px-4 sm:px-8 py-10 relative z-0">
                                <div className="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10">
                                    <div>
                                        <div className="flex items-center gap-2 mb-2"><h2 className="text-3xl font-bold text-stone-800 flex items-center gap-3">{activeCategory === 'shared_collection' ? '精選花束 (分享)' : activeCategory === 'recent' ? '最近翻土' : activeCategory === 'all' ? '花園全貌' : activeCategory === 'uncategorized' ? '未分類種子' : `# ${activeCategory}`}</h2>{!isAuthorized && <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-amber-100 text-amber-800 border border-amber-200">Guest View (#share)</span>}</div>
                                        <p className="text-stone-500 font-medium">目前共培育了 {processedData.totalItems} 株知識樹</p>
                                    </div>
                                    <div className="flex flex-col sm:flex-row gap-3 items-stretch sm:items-center bg-white p-1.5 rounded-2xl shadow-sm border border-stone-200">
                                        <div className="relative group min-w-[240px]">
                                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-stone-400"><Icons.Search /></div>
                                            <input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="block w-full pl-10 pr-10 py-2.5 border-none rounded-xl bg-transparent focus:ring-0 text-sm text-stone-700 placeholder-stone-400" placeholder="搜尋花園... (例如 #工作)" />
                                            <div className="absolute inset-y-0 right-0 pr-3 flex items-center cursor-help has-tooltip"><div className="text-stone-300 hover:text-emerald-500 transition-colors"><Icons.Info /></div><div className="tooltip"><p className="font-bold mb-1 text-emerald-300">花園搜尋語法：</p><ul className="list-disc list-inside space-y-1 text-stone-300"><li>AND: <code className="bg-stone-700 px-1 rounded">&</code></li><li>OR: <code className="bg-stone-700 px-1 rounded">|</code></li><li>NOT: <code className="bg-stone-700 px-1 rounded">!</code></li></ul></div></div>
                                        </div>
                                        {activeCategory !== 'recent' && <><div className="h-6 w-px bg-stone-200 hidden sm:block mx-1"></div><div className="flex gap-2"><div className="relative"><select value={sortField} onChange={(e) => setSortField(e.target.value)} className="appearance-none bg-stone-50 hover:bg-stone-100 border border-stone-200 text-stone-600 text-sm py-2 pl-3 pr-8 rounded-xl focus:outline-none cursor-pointer font-medium transition-colors"><option value="modified_at">最近灌溉</option><option value="created_at">種植時間</option><option value="title">品種名稱</option></select><div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-stone-400"><Icons.ArrowDown /></div></div><button onClick={() => setSortOrder(o => o === 'asc' ? 'desc' : 'asc')} className="p-2 bg-stone-50 hover:bg-stone-100 border border-stone-200 rounded-xl text-stone-500 hover:text-emerald-600 transition-colors">{sortOrder === 'asc' ? <Icons.SortAsc /> : <Icons.SortDesc />}</button></div></>}
                                        {useRealApi && <button onClick={fetchDiagrams} disabled={loading} className="p-2 bg-emerald-50 hover:bg-emerald-100 border border-emerald-100 rounded-xl text-emerald-600 transition-colors ml-1"><Icons.Refresh spin={loading} /></button>}
                                    </div>
                                </div>
                                {error && <div className="mb-8 p-4 bg-rose-50 text-rose-700 rounded-2xl border border-rose-100 flex items-center gap-3"><Icons.Bug /> {error}</div>}
                                {processedData.totalItems === 0 ? (
                                    <div className="text-center py-32 animate-fade-in flex flex-col items-center">
                                        <div className="w-24 h-24 rounded-full bg-stone-100 flex items-center justify-center text-stone-300 mb-6 shadow-inner"><Icons.Flower /></div>
                                        <h3 className="text-xl font-bold text-stone-700 mb-2">這片區域還是一片荒地</h3>
                                        <p className="text-stone-500 max-w-md mx-auto">{collectionIds ? "連結中的 ID 似乎無法讀取，或者這些檔案未公開。" : (isAuthorized ? "試著在 Mindomo 的描述欄位加上 #標籤 來播種吧！" : "目前沒有公開分享 (#share) 的植栽。")}</p>
                                        {collectionIds && <button onClick={() => { setCollectionIds(null); setActiveCategory('all'); window.history.replaceState(null, '', window.location.pathname); }} className="mt-4 px-4 py-2 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 transition-colors">查看全部</button>}
                                    </div>
                                ) : (<div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 pb-10">{processedData.items.map((item) => (<GardenCard key={item.id} item={item} />))}</div>)}
                                <Pagination />
                                {selectedIds.size > 0 && <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-stone-900/90 text-white backdrop-blur-md px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-6 animate-slide-up border border-stone-700"><div className="flex items-center gap-2"><span className="bg-emerald-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">{selectedIds.size}</span><span className="text-sm font-medium">已選取</span></div><div className="h-4 w-px bg-stone-700"></div><button onClick={handleGenerateCollectionLink} className="flex items-center gap-2 text-sm font-bold hover:text-emerald-400 transition-colors"><Icons.Link /> 複製分享連結</button><div className="h-4 w-px bg-stone-700"></div><button onClick={() => setSelectedIds(new Set())} className="flex items-center gap-1 text-sm text-stone-400 hover:text-white transition-colors"><Icons.X /> 清除</button></div>}
                                {showPasswordModal && <PasswordModal onSubmit={() => { setIsAuthorized(true); setShowPasswordModal(false); }} onClose={() => setShowPasswordModal(false)} />}
                                {useRealApi && rawData && showDebug && <div className="mt-16 p-6 bg-stone-900 text-stone-300 rounded-2xl shadow-2xl animate-fade-in border border-stone-800"><button onClick={() => setShowDebug(false)}>Close</button><pre>{JSON.stringify(rawData, null, 2)}</pre></div>}
                            </div>
                        </main>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
