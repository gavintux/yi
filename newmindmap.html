<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Mindomo å¡ç‰‡å¼æª”æ¡ˆç€è¦½</title>
  <style>
    body { font-family: "Segoe UI", "å¾®è»Ÿæ­£é»‘é«”", "Arial"; background:#f7f8fa; margin:0; }
    .container { display: flex; min-height: 100vh; }
    .sidebar { width: 225px; background: #fff; border-right:1px solid #e5eaf2; padding: 24px 0 0 0; box-shadow: 1px 0 8px #eaecf2; }
    .sidebar h2 { margin: 2px 24px 18px 32px; color:#276beb;}
    .sidebar .section { margin: 18px 0 0 32px;}
    .sidebar .section-title {font-size:15px;font-weight:bold;color:#555;}
    .sidebar ul {padding:0;margin:8px 0;}
    .sidebar li {list-style:none; margin:8px 0; font-size:14px; cursor:pointer;}
    .selected {background:#e7f2fd;color:#276beb;border-radius:3px;}
    .main-content {flex:1;padding:32px;}
    .header { display:flex; align-items:center; margin-bottom:18px;}
    .header input[type=text] { width:240px;height:32px;border-radius:4px;border:1px solid #ddd;padding:0 10px;font-size:14px; margin-right:18px;}
    .header select {height:32px;font-size:14px;}
    .card-grid { display:grid; grid-template-columns: repeat(3,1fr); gap:20px;}
    .card { background:#fff; border-radius:8px; box-shadow:0 2px 8px #e5eaf2; padding:22px 20px; min-height:120px; display:flex; flex-direction:column; justify-content:space-between;position:relative; transition:box-shadow .2s;}
    .card:hover {box-shadow:0 8px 20px #d2e3fa;}
    .card-title {font-weight: bold; font-size: 17px; margin-bottom: 8px;}
    .card-meta {color:#888;font-size:13px;display:flex;align-items:center;}
    .card-btn { position: absolute; top:18px; right:18px; background:#ecf4ff; color:#2c68d0; border:none; border-radius:5px; padding:6px 16px; cursor:pointer;font-weight:bold; transition:background .2s;}
    .card-btn:hover {background:#d6eaff;}
    .pagination { margin:26px 0 0 0; text-align:center;}
    .pagination button { background:#f3f7fa; border:1px solid #abc; border-radius:4px; margin:0 3px; padding:6px 14px; cursor:pointer;}
    .pagination .active {background:#276beb;color:#fff;}
    #apiDiv { background: #fff; box-shadow:0 2px 6px #e5eaf2; padding:42px; position:fixed; top:23%; left:50%; transform:translateX(-50%); z-index:99; border-radius:14px;}
    #apiDiv h3 {margin:0 0 18px 0;}
    #apiKey { user-select: none; width:260px;font-size:16px;}
    #hideTip { color: #888; font-size: 12px; margin-left:8px;}
    #apiDiv button {font-size:16px;padding:6px 18px; margin-left:18px;}
  </style>
</head>
<body>
<div id="apiDiv">
  <h3>è«‹è¼¸å…¥ Mindomo API key</h3>
  <input type="password" id="apiKey" autocomplete="new-password">
  <button onclick="submitKey()">ç¢ºå®š</button>
  <span id="hideTip">ï¼ˆåªä¿å­˜æ–¼æœ¬é é¢è¨˜æ†¶é«”ï¼Œè¼¸å…¥å¾Œéš±è—ä¸”ä¸å¯è¤‡è£½ï¼Œä¸å¤–æ´©ï¼‰</span>
</div>
<div class="container" style="display:none" id="mainBox">
  <div class="sidebar">
    <h2>Mindomo</h2>
    <div class="section">
      <div class="section-title">åˆ†çµ„è³‡æ–™å¤¾ (PARA)</div>
      <ul id="folderList"></ul>
    </div>
  </div>
  <div class="main-content">
    <div class="header">
      <input type="text" id="searchBox" placeholder="æœå°‹...">
      <select id="sortKey">
        <option value="name">æª”æ¡ˆåç¨±</option>
        <option value="createdAt">å»ºç«‹æ™‚é–“</option>
        <option value="updatedAt">ä¿®æ”¹æ™‚é–“</option>
      </select>
      <select id="sortOrder">
        <option value="asc">éå¢</option>
        <option value="desc">éæ¸›</option>
      </select>
    </div>
    <div id="fileStats" style="font-size:14px;color:#888;margin-bottom:18px;"></div>
    <div class="card-grid" id="cardGrid"></div>
    <div class="pagination" id="pagination"></div>
  </div>
</div>

<script>
let allFiles = [], allFolders = [], currentFolder = 'å…¨éƒ¨æª”æ¡ˆ', currentPage = 1, PAGE_SIZE = 12;
function submitKey() {
  let apiKey = document.getElementById("apiKey").value;
  document.getElementById("apiDiv").style.display = "none";
  document.getElementById("mainBox").style.display = "flex";

  // API æ¬„ä½çµ„åˆï¼Œè«‹æ ¹æ“šä½ çš„ Mindomo API response å¾®èª¿
  fetch("https://www.mindomo.com/api/v1/diagrams", {
    headers: { Authorization: `Bearer ${apiKey}` }
  }).then(response => response.json())
    .then(files => {
      // å‡è¨­ files ç‚º arrayï¼Œæ¯ç­†å«id/name/folder/createdAt/updatedAt
      allFiles = files.map(f => ({
        id: f.id || f.diagramId || "",          // Mindomo åœ°åœ–ID
        name: f.name || f.title || "",          // åœ°åœ–å
        folder: f.folder || f.category || "æœªåˆ†é¡", // åˆ†é¡æˆ–è³‡æ–™å¤¾
        createdAt: formatTime(f.createdAt),     // å»ºç«‹æ™‚é–“
        updatedAt: formatTime(f.updatedAt)      // ä¿®æ”¹æ™‚é–“
      }));
      // æ”¶é›†æ‰€æœ‰è³‡æ–™å¤¾
      let set = new Set();
      allFiles.forEach(f => set.add(f.folder));
      allFolders = Array.from(set).filter(fld => fld); // ç§»é™¤ undefined/ç©ºå­—ä¸²
      renderAll();
    });
}
function formatTime(val) {
  if (!val) return "";
  const dt = new Date(val);
  if (isNaN(dt.getTime())) return val; //åŸå§‹å­—ä¸²
  let y=dt.getFullYear(),m=dt.getMonth()+1,d=dt.getDate(),hr=dt.getHours(),min=dt.getMinutes();
  let ap=hr>=12?"ä¸‹åˆ":"ä¸Šåˆ";hr=hr>12?hr-12:hr;
  return `${y}/${m}/${d} ${ap}${hr.toString().padStart(2,"0")}:${min.toString().padStart(2,"0")}`;
}
function groupFiles(){ return allFiles.filter(f => currentFolder==='å…¨éƒ¨æª”æ¡ˆ'||f.folder===currentFolder);}
function renderSidebar(){
  let html = '<li'+(currentFolder==='å…¨éƒ¨æª”æ¡ˆ'?' class="selected"':'')+'" onclick="selectFolder(\'å…¨éƒ¨æª”æ¡ˆ\')">å…¨éƒ¨æª”æ¡ˆ</li>';
  allFolders.forEach(fld => html += `<li${fld===currentFolder?' class="selected"':''} onclick="selectFolder('${fld}')">${fld}</li>`);
  document.getElementById("folderList").innerHTML = html;
}
function selectFolder(fld){ currentFolder=fld; currentPage=1; renderAll();}
function renderCards(){
  let searchVal = document.getElementById("searchBox").value.toLowerCase();
  let sortKey = document.getElementById("sortKey").value;
  let sortOrder = document.getElementById("sortOrder").value;
  let files = groupFiles().filter(f=>(f.name||"").toLowerCase().includes(searchVal));
  files.sort((a,b)=>{
    let aVal=a[sortKey]||"",bVal=b[sortKey]||"";
    if(sortKey!=='name'){aVal=new Date(aVal).getTime();bVal=new Date(bVal).getTime();}
    return sortOrder==='asc'?aVal-bVal:bVal-aVal;
  });
  let total=files.length, totalPages=Math.max(1,Math.ceil(total/PAGE_SIZE));
  if(currentPage>totalPages)currentPage=totalPages;
  let showFiles=files.slice((currentPage-1)*PAGE_SIZE, currentPage*PAGE_SIZE);
  let grid = document.getElementById("cardGrid"); grid.innerHTML = "";
  showFiles.forEach(f => {
    grid.innerHTML += `
      <div class="card">
        <div class="card-title">${f.name||""}</div>
        <button class="card-btn" onclick="window.open('https://www.mindomo.com/mindmap/${f.id}','_blank')">é–‹å•Ÿ</button>
        <div class="card-meta">ğŸ•’ æœ€å¾Œä¿®æ”¹æ–¼ ${f.updatedAt||""}</div>
      </div>
    `;
  });
  document.getElementById("fileStats").innerText = "å…± "+total+" å€‹é …ç›®ï¼Œé  "+currentPage+"/"+totalPages;
  let pagHtml = "";
  for(let i=1;i<=totalPages;i++)
    pagHtml += `<button class="${i===currentPage?'active':''}" onclick="gotoPage(${i})">${i}</button>`;
  document.getElementById("pagination").innerHTML = pagHtml;
}
function gotoPage(p){ currentPage=p; renderAll();}
function renderAll(){ renderSidebar(); renderCards(); }
document.getElementById("searchBox").oninput = renderAll;
document.getElementById("sortKey").onchange = renderAll;
document.getElementById("sortOrder").onchange = renderAll;
</script>
</body>
</html>
